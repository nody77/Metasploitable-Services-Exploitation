## Metasploitable 2 - port 80 http - Exploitation

Before trying to exploit the http port in metasploitable, first we need to scan the port to make sure it is open 
so let's try 

```Terminal
nmap -p 80 -sV <metasploitable ip address>
```

![alt text](https://github.com/nody77/Metasploitable-Services-Exploitation/blob/a4f60f720682cf15294193814dc6259accd5ec6a/Screenshot%202023-04-30%20111351.png)

So as we can see the port for the http protocol is open and its version is Apache 2.2.8 (Ubuntu).
After knowing that information let's open msfconsole to get more information about that version.

```Terminal
msfconsole
```

![alt text](https://github.com/nody77/Metasploitable-Services-Exploitation/blob/a4f60f720682cf15294193814dc6259accd5ec6a/Screenshot%202023-04-30%20111443.png)

After opening the msfconsole, we will search for the http_version

```Terminal
search http_version
```

![alt text](https://github.com/nody77/Metasploitable-Services-Exploitation/blob/a4f60f720682cf15294193814dc6259accd5ec6a/Screenshot%202023-04-30%20111817.png)

Then we will choose auxiliary/scanner to gather more information

```Terminal
use 0
```

![alt text](https://github.com/nody77/Metasploitable-Services-Exploitation/blob/a4f60f720682cf15294193814dc6259accd5ec6a/Screenshot%202023-04-30%20111839.png)

![alt text](https://github.com/nody77/Metasploitable-Services-Exploitation/blob/a4f60f720682cf15294193814dc6259accd5ec6a/Screenshot%202023-04-30%20111852.png)

So now let show the options of that script to give the ip address of the metasplitable machine

```Terminal
show options
```

![alt text](https://github.com/nody77/Metasploitable-Services-Exploitation/blob/a4f60f720682cf15294193814dc6259accd5ec6a/Screenshot%202023-04-30%20111926.png)

Now let's set the rhosts to the ip address of the metasplitable machine

```Terminal
set rhosts <metasploitable ip address>
```

![alt text](https://github.com/nody77/Metasploitable-Services-Exploitation/blob/a4f60f720682cf15294193814dc6259accd5ec6a/Screenshot%202023-04-30%20112013.png)

So now let's show the options again before running it to make sure that the changes took place

![alt text](https://github.com/nody77/Metasploitable-Services-Exploitation/blob/a4f60f720682cf15294193814dc6259accd5ec6a/Screenshot%202023-04-30%20112037.png)

The changes took place, so let's run now

![alt text](https://github.com/nody77/Metasploitable-Services-Exploitation/blob/a4f60f720682cf15294193814dc6259accd5ec6a/Screenshot%202023-04-30%20112110.png)

So now as we can see that the version is powered by php, so lets go to the metasploitable website and write phpinfo to know more about it

![alt text](https://github.com/nody77/Metasploitable-Services-Exploitation/blob/a4f60f720682cf15294193814dc6259accd5ec6a/Screenshot%202023-04-30%20112224.png)

Now let's open the msfconsole again and search for dir scanner

```Terminal
search dir_scanner
```

![alt text](https://github.com/nody77/Metasploitable-Services-Exploitation/blob/a4f60f720682cf15294193814dc6259accd5ec6a/Screenshot%202023-04-30%20112803.png)

And then choose 0 index

![alt text](https://github.com/nody77/Metasploitable-Services-Exploitation/blob/a4f60f720682cf15294193814dc6259accd5ec6a/Screenshot%202023-04-30%20112857.png)

And as usual see the options of it

![alt text](https://github.com/nody77/Metasploitable-Services-Exploitation/blob/a4f60f720682cf15294193814dc6259accd5ec6a/Screenshot%202023-04-30%20112937.png)

So now let's set the rhosts with the ip address of the metasplitable machine again to run 

![alt text](https://github.com/nody77/Metasploitable-Services-Exploitation/blob/a4f60f720682cf15294193814dc6259accd5ec6a/Screenshot%202023-04-30%20113022.png)

![alt text](https://github.com/nody77/Metasploitable-Services-Exploitation/blob/a4f60f720682cf15294193814dc6259accd5ec6a/Screenshot%202023-04-30%20113055.png)

So as we can see it returned 6 directories so now let's try to get access through the php_cgi

First let's search for it 

```Terminal
search php_cgi
```

![alt text](https://github.com/nody77/Metasploitable-Services-Exploitation/blob/a4f60f720682cf15294193814dc6259accd5ec6a/Screenshot%202023-04-30%20113413.png)

And choose 0

![alt text](https://github.com/nody77/Metasploitable-Services-Exploitation/blob/a4f60f720682cf15294193814dc6259accd5ec6a/Screenshot%202023-04-30%20113509.png)

So as we can see we will use the php_cgi_arg_injection payload
Before running it we need to set the rhosts to our metasploitable machine ip address
And then we can exploit it

![alt text](https://github.com/nody77/Metasploitable-Services-Exploitation/blob/a4f60f720682cf15294193814dc6259accd5ec6a/Screenshot%202023-04-30%20113632.png)

![alt text](https://github.com/nody77/Metasploitable-Services-Exploitation/blob/a4f60f720682cf15294193814dc6259accd5ec6a/Screenshot%202023-04-30%20113656.png)

As we can see a meterpreter session is opened and we now have access to run commands on this machine and get the information 
on the machine.

